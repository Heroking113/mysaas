(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{306:function(e,t,a){"use strict";a.r(t);var i=a(322);var s=a(312);for(var r in s)if(r!=="default")(function(e){a.d(t,e,function(){return s[e]})})(r);var n=a(319);var o=a(12);var l=Object(o["a"])(s["default"],i["a"],i["b"],false,null,"3bb8284c",null);t["default"]=l.exports},312:function(e,t,a){"use strict";a.r(t);var i=a(313);var s=a.n(i);for(var r in i)if(r!=="default")(function(e){a.d(t,e,function(){return i[e]})})(r);t["default"]=s.a},313:function(e,t,a){"use strict";var i=a(3);Object.defineProperty(t,"__esModule",{value:true});t.default=void 0;var s=i(a(98));var r=i(a(99));var n={components:{},data:function e(){return{dialogVisible:false,dialogInfo:[],operators:[{operator_name:"所有用户"}],operator_name:"",businesses:[{busi_name:"所有业务"}],busi_name:"",missions:[{mission_name:"所有任务"}],mission_name:"",records:[],current_page:1,record_num:0,page_size:0,pager_count:0,is_initial:false,is_search:false,is_all_finished:true,timer:""}},created:function e(){this.is_search=false;this.initial_data()},mounted:function e(){var t=this;this.timer=setInterval(function(){if(t.is_all_finished===false){t.query_mission_records()}},5e3)},beforeDestroy:function e(){clearInterval(this.timer)},methods:{handleGetLog:function e(t,a){var i=this;var s=document.cookie.split(";");var r="";for(var n in s){if(s[n].indexOf("csrftoken")!=-1){var r=s[n].split("=")[1]}}var o={row:a};this.$http.post("/deliever_log/",o,{headers:{"X-CSRFToken":r}}).then(function(e){i.dialogInfo.length=0;if(e.data.result){i.dialogInfo=e.data.data.step_results[0].ip_logs;i.dialogVisible=true}else{i.dialogInfo.push({ip:"null",log_content:e.data.data});i.dialogVisible=true}})},onQuery:function e(){var t=this;var a=(0,s.default)("#cur_business").val();var i=(0,s.default)("#cur_operator").val();var r=(0,s.default)("#cur_mission").val();var n="/records/?business_name="+a+"&operator="+i+"&mission_name="+r+"&page=1";this.$http.get(n).then(function(e){t.is_search=true;if(e.data.result){t.records=e.data.data;t.current_page=1;t.record_num=e.data.count;t.page_size=t.records.length;t.pager_count=Math.ceil(t.record_num/t.page_size)}})},goExecute:function e(){this.$router.push({path:window.PROJECT_CONFIG.SITE_URL+"execute-task"})},handleCurrentChange:function e(t){var a=this;var i=null;if(this.is_search){var r=(0,s.default)("#cur_business").val();var n=(0,s.default)("#cur_operator").val();var o=(0,s.default)("#cur_mission").val();i="/records/?page="+t+"&business_name="+r+"&operator="+n+"&mission_name="+o}else{i="/records/?page="+t}this.$http.get(i).then(function(e){if(e.data.result){a.records=e.data.data;a.current_page=t}})},initial_data:function e(){this.query_mission_records();this.query_mission_conditions()},query_mission_records:function e(){var t=this;this.$http.get("/records/?page=1").then(function(e){if(e.data.result){t.records=e.data.data;t.record_num=e.data.count;if(t.is_initial===false){t.page_size=t.records.length;t.pager_count=Math.ceil(t.record_num/t.page_size)}t.is_initial=true;t.judge_all_finished()}else{t.$message.error("获取任务执行记录失败")}})},query_mission_conditions:function e(){var t=this;this.$http.get("/records/conditions/").then(function(e){if(e.data.result){var a=e.data.data.businesses;var i=e.data.data.operators;var s=e.data.data.missions;a.forEach(function(e){t.businesses.push({busi_name:e})});i.forEach(function(e){t.operators.push({operator_name:e})});s.forEach(function(e){t.missions.push({mission_name:e})})}else{t.$message.error("获取筛选条件失败")}})},judge_all_finished:function e(){for(var t in this.records){if(this.records[t].status==="执行中"){this.is_all_finished=false;break}}}}};t.default=n},314:function(e,t,a){},319:function(e,t,a){"use strict";var i=a(314);var s=a.n(i);var r=s.a},322:function(e,t,a){"use strict";var i=function(){var e=this;var t=e.$createElement;var a=e._self._c||t;return a("div",[a("el-container",[a("el-header",{staticClass:"head-left-content"},[a("el-button",{staticClass:"navibar-button-style",attrs:{type:"primary"},on:{click:e.goExecute}},[e._v("执行任务")]),e._v(" "),a("el-button",{staticClass:"navibar-button-style",staticStyle:{"background-color":"#0a6659"},attrs:{id:"record",type:"primary"}},[e._v("任务记录")])],1)],1),e._v(" "),a("div",{staticClass:"container"},[a("div",{staticClass:"table-style"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:true}},[a("el-form-item",{attrs:{label:"业务"}},[a("el-select",{ref:"select_business",staticStyle:{width:"317px"},attrs:{id:"cur_business",placeholder:"请选择"},on:{change:e.get_select_business_label},model:{value:e.busi_name,callback:function(t){e.busi_name=t},expression:"busi_name"}},e._l(e.businesses,function(e){return a("el-option",{key:e.busi_name,attrs:{value:e.busi_name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"用户"}},[a("el-select",{ref:"select_user",staticStyle:{width:"317px"},attrs:{id:"cur_operator",placeholder:"请选择"},model:{value:e.operator_name,callback:function(t){e.operator_name=t},expression:"operator_name"}},e._l(e.operators,function(e){return a("el-option",{key:e.operator_name,attrs:{value:e.operator_name}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"任务"}},[a("el-select",{ref:"select_script",staticStyle:{width:"317px"},attrs:{id:"cur_mission",placeholder:"请选择"},model:{value:e.mission_name,callback:function(t){e.mission_name=t},expression:"mission_name"}},e._l(e.missions,function(e){return a("el-option",{key:e.mission_name,attrs:{value:e.mission_name}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onQuery}},[e._v("查询")])],1)],1),e._v(" "),a("hr",{staticStyle:{FILTER:"alpha(opacity=100,finishopacity=0,style=3)"},attrs:{width:"100%",color:"gray",size:"1"}}),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.records,border:""}},[a("el-table-column",{attrs:{align:"center",prop:"business_name",label:"业务",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"operator",label:"用户",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"mission_name",label:"任务",width:"200"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"machine_num",label:"机器数",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"status",label:"状态",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{align:"center",prop:"create_time",label:"操作时间",width:"300"}}),e._v(" "),a("el-table-column",{staticStyle:{width:"200"},attrs:{label:"操作",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){e.handleGetLog(t.$index,t.row)}}},[e._v("查看日志")])]}}])})],1),e._v(" "),a("div",{staticClass:"paginationClass",staticStyle:{float:"right"}},[a("el-pagination",{attrs:{background:"","current-page":e.current_page,total:e.record_num,"page-size":e.page_size,"pager-count":e.pager_count,layout:"prev, pager, next, jumper"},on:{"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"日志信息",visible:e.dialogVisible,width:"30%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[e._l(e.dialogInfo,function(t,i){return a("div",{key:i},[a("span",[e._v("主机: "+e._s(t.ip))]),e._v(" "),a("br"),e._v(" "),a("span",[e._v("日志信息: "+e._s(t.log_content))])])}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],2)],1)};var s=[];a.d(t,"a",function(){return i});a.d(t,"b",function(){return s})}}]);